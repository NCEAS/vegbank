BACKUP_DIR=/usr/vegbank/backup
TS=`date +%d%b%G`
BACKUP_FILE_PATH=$BACKUP_DIR/vegbank$TS.sql
LATEST_DUMP=$BACKUP_DIR/vegbank_latest.sql.bz2
PG_DUMP=/usr/local/pgsql/bin/pg_dump
SCP_USER=anderson
REMOTE_DEST=$SCP_USER@aldo.vegbank.org:vbdumps

$PG_DUMP -U datauser --no-owner --no-privileges vegbank > $BACKUP_FILE_PATH

bzip2 -f --best $BACKUP_FILE_PATH
rm $LATEST_DUMP
ln -s $BACKUP_FILE_PATH.bz2 $LATEST_DUMP
su -c "scp $LATEST_DUMP $REMOTE_DEST" $SCP_USER
