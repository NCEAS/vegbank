<?xml version="1.0"?>
<!-- 
  * build_client.xml
  *
  *	Authors: John Harris
  *	Copyright: 2000 Regents of the University of California and the
  *           National Center for Ecological Analysis and Synthesis
  *  Build file for the Ant cross-platform build system for metacat
  *  See http://jakarta.apache.org for details on Ant  
  *  
	* this build file builds the client software for the 
	* national plots database including: the interfaces, the
	* embedded database(s) etc.  Before building this check the 
	* dependencies
--> 
<project name="plotLoader" default="dist" basedir=".">
	<target name="init">
	<tstamp/>
  
	<property name="current" value="./" />
	<property name="build" value="./build" />
	<property name="build_src" value="./build/src/client" />
	<property name="build_xml" value="build/xml" />
	<property name="build_lib" value="build/lib" />
	<property name="build_html" value="build/html" />
	<property name="build_bin" value="build/bin" />
	<property name="build_data" value="build/data" />
	
	<property name="build_legacy_loader" value="build/src/client/legacy_data_loader" />
	<property name="build_client" value="./build/src/client" />
	<property name="build_embedded_db" value="./build/src/client/embedded_db" />
	<property name="src_client" value="./client" />
	<property name="src_legacy_loader" value="./legacy_data_loader" />
	<property name="src_embedded_db" value="./embeddedDB" />
	<property name="src_bin" value="../bin" />
	<property name="src_lib" value="../lib" />
	<property name="src_xml" value="../xml"/>
	<property name="utility_src" value="./utilities" />
	<property name="src_embedded_db" value="./embeddedDB" /> 

	<property name="dbAccess_src" value="./plotAccess"/>
	<property name="database_access_module" value="build/lib/dbAccess.jar" />
	<property name="jdbc_drivers" value="build/lib/idb.jar" />
  <property name="xerces" value="../lib/xerces_1_3_1.jar" />
	<property name="xalan" value="../lib/xalan_1_2_2.jar" /> 

	<filter token="release" value="DEVELOPMENT"/>
	<filter token="authors" value="HARRIS"/>
	
	
<property name="cpath" 
value="${xerces}:${xalan}:${jdbc_drivers}:${database_access_module}:${build_communication}:${build_interface}:./"/>
</target>

<target name="prepare" depends="init">
	<mkdir dir="${build_client}" />
	<mkdir dir="${build_embedded_db}" />
	<mkdir dir="${build_legacy_loader}" />
	
	
<!-- 
	* get the resources for the embedded database 
	* including the java classes used to replicate 
	* data between the central server and the local 
	* database as well as to optomize the local database  
	* and the database properties file(s)
-->
	<copydir src="${src_embedded_db}"
		dest="${build_embedded_db}"
    filtering="yes"
		includes="**.java **.properties"
		excludes="**/CVS* "
	/>

	<!-- GET THE SCRIPTS TO START THE CLEINT-->
	<copydir src="${src_bin}"
		dest="${build_bin}"
    filtering="yes"
		includes="vegclient.sh vegclient.bat"
		excludes="**/CVS* "
	/>


<!--
	* copy the Enhydra / InstantDb properties file (*.prp) into 
	* the build_data file - this is the location for the 
	* embedded database
	-->
	<copyfile src="${src_lib}/nvc.prp"
  	filtering="yes"
	  dest="${build_data}/nvc.prp"
	/>
			

<!-- 
	* get the source code from the client directory that contains
	* all the code for the client including both the interface classes
	* and the communication classes
	-->
	<copydir src="${src_client}"
		dest="${build_client}"
    filtering="yes"
    includes=" NestedQueryBuilder.java VegClient.java QueryModule.java
		HtmlViewer.java DataRequestClient.java 
			DataExchangeClient.java DataUpload.java 
			HttpMessage.java 
			DataRequestHandler.java **.properties"
    excludes="**/CVS* "
	/>
	
	<!--
		* the legacy data loader code
		-->
	<copydir src="${src_legacy_loader}"
		dest="${build_legacy_loader}"
    filtering="yes"
    includes="**.java **.properties"
    excludes="**/CVS* "
	/>
	
	<copydir src="${src_xml}"
		dest="${build_xml}"
    filtering="yes"
    includes="legacyDataDescription.dtd legacyDataDescription.xsl"
    excludes="**/CVS* "
	/>


	
	<!--
		* now get any binary files that should not be filtered
		* -->
		<copydir src="${src_client}" 
		dest="${build_client}" 
    filtering="no"
    includes="**.gif **.jpeg"
    excludes="**/CVS* "
	/>

</target>	
	
	
<!-- compile all the java code -->
<target name="compile" depends="prepare">

<javac srcdir="${build_client}" 
		classpath="${cpath}"
		includes="**.java  "
		destdir="${build_client}"
	/>
	
	<javac srcdir="${build_embedded_db}" 
		classpath="${cpath}"
		includes="**.java  " 
		destdir="${build_embedded_db}"
	/>
	
	<javac srcdir="${build_legacy_loader}" 
		classpath="${cpath}"
		includes="**.java  " 
		destdir="${build_legacy_loader}"
	/>
	
</target>	
	
	
	
<target name="dist" depends="compile">
	
<!-- 
	* archive the client communication classes
	* into a single archive
-->
	<jar jarfile ="${build_lib}/client.jar"
		basedir="${build_client}"
		manifest="${src_client}/manifest"
		includes="${build_client}/ ** "
	/>
	

<!--
	<jar jarfile ="${build_lib}/interface.jar"
		basedir="${build_interface}"
		manifest="${build_interface}/manifest"
		includes="${build_interface}/ ** ${src_interface}/test.gif"
	/>
-->

	<!-- jar the embedded database classes into a jar file -->
	<jar jarfile ="${build_lib}/embedded_db.jar"
		basedir="${build_embedded_db}"
		includes="${build_embedded_db}/ ** "
	/>
	
	<!-- the legacy data formatter -->
	<jar jarfile ="${build_lib}/legacy_formatter.jar"
		basedir="${build_legacy_loader}"
		includes="${build_legacy_loader}/ ** "
	/>
	
	
</target>

</project>
