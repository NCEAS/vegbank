<?xml version="1.0"?>
<!-- 
  * buildServlet.xml
  *
  *	Authors: John Harris
  *	Copyright: 2000 Regents of the University of California and the
  *           National Center for Ecological Analysis and Synthesis
  *  Build file for the Ant cross-platform build system for metacat
  *  See http://jakarta.apache.org for details on Ant  
  *  
  * This build file will build the plot database access 
  * module and insert into a working version of the plots 
  * database an xml plot record, then query that database
  * for all plots containing a taxon containing the string
  * "Carya".
  * usage: ant [compile|jar|install|jdoc]
--> 
<project name="plotLoader" default="dist" basedir=".">
	<target name="init">
	<tstamp/>
	
	<property name="installDir" value="C://jakarta-tomcat/webapps/examples/WEB-INF/lib/" />
  <property name="web_docs" value="../html" />
	<property name="src_image_content" value="../html/images" />
	<property name="build_image_content" value="C://jakarta-tomcat/webapps/ROOT/images" />
	<property name="file_upload_dir" value="C://jakarta-tomcat/webapps/ROOT/uploads" />
	
	<property name="current" value="./" />
	<property name="build" value="build" />
	<property name="build_src" value="build/src/servlet" />
	<property name="build_lib" value="build/lib" />
	<property name="build_html" value="build/html" />
	<property name="build_multipart_src" value="build/src/servlet/multipart" />
	<property name="database_access_module" value="build/lib/dbAccess.jar" />
	
	<property name="dist" value="dist" />
	<property name="release" value="development"/>
	<property name="src" value="./servlet"/>
	<property name="dbaccess_src" value="./plotAccess"/>
	<property name="utility_src" value="./utilities"/>	
	<property name="src_xml" value="../xml"/>
	<property name="src_bin" value="../bin" />
	<property name="src_lib" value="../lib" />
	
	<!-- these properties are for the web content / navigation -->
	<property name="servlet_home" value="C://jakarta-tomcat/lib/servlet.jar" />
	<property name="server" value="127.0.0.1:8080"/>
	<property name="servlet-path" value="/examples/servlet/"/>
  <property name="html-path" value="/examples"/>
  <property name="image-path" value="/examples/images" />
	
	<property name="jdbc" value="../lib/jdbc7.0-1.2.jar" />
	<property name="multipart" value="./servlet/multipart" />
	<property name="cpath" value="${servlet_home}:${database_access_module}:${xmlp}:${jdbc}:${build}:./"/>
	
	<filter token="server" value="${server}" />
	<filter token="servlet-path" value="${servlet-path}" />
</target>

<target name="prepare" depends="init">
	<mkdir dir="${build}" />
	
	<mkdir dir="${build}" />
	<mkdir dir="${build_lib}" />
	<mkdir dir="${build_src}" />
	<mkdir dir="${build_sql}" />
	<mkdir dir="${build_xml}" />
	<mkdir dir="${build_bin}" />
	<mkdir dir="${build_html}" />
	<mkdir dir="${file_upload_dir}" />
	
	<mkdir dir="${dist}" />
	<mkdir dir="${build_multipart_src}" />
	
	<copydir src="${src}" 
		dest="${build_src}" 
		filtering="yes"
		includes="**.java pageDirector.properties 
		fileDownload.properties  plotQuery.properties"
		excludes="**/CVS* MetaCatServlet.java"
	/>
	
	<copydir src="${src_lib}" 
		dest="${build_src}" 
		filtering="yes"
		includes="LocalStrings.properties"
		excludes="**/CVS* MetaCatServlet.java"
	/>
	
	<!-- 
		* this is the directory to store all 
		*	the multipart decoding stuff 
	-->
		<copydir src="${multipart}" 
			dest="${build_multipart_src}" 
      filtering="yes"
      includes="**.java"
      excludes="**/CVS* "
		/>
			   
	<!-- grab the utility classes that will be needed for such things as data
	 	formatting-->
	<copydir src="${utility_src}" 
  	dest="${build_src}" 
    filtering="no"
    includes="PlotDataMapper.java  PlotXmlWriter.java"
		excludes="**/CVS* "
	/>
	<copydir src="${web_docs}" 
  	dest="${build_html}"
		filtering="yes"
		includes="**.html"
		excludes="**/CVS* "
	/>
	 
</target>	
	
<target name="compile" depends="prepare">
	<!--	
		* the files in the multipart directory will get compiled also
	-->	
	<javac srcdir="${build_src}" 
		classpath="${cpath}"
		includes="**.java  " 
		destdir="${build_src}"
	/>
	
</target>	
	
<target name="dist" depends="compile">

<!--	
	<mkdir dir="${dist}" />
	<deltree dir="${dist}" />
-->
	<jar jarfile ="${build_lib}/servletmodule.jar"
		basedir="${build_src}"
		includes="**"
		excludes="${build_src}/**.jar"
	/>
	
	<jar jarfile ="${build_lib}/multipart.jar"
		basedir="${build_src}"
		includes="**"
		excludes="${build_src}/**.jar"
	/>
<!--
	* copy the revelvant files to the 
	* install directory under jakarta tomcat 
	*
	-->
	<copydir src="${build_lib}" 
  	dest="${installDir}" 
    filtering="no"
    includes=" servletmodule.jar dbAccess.jar xerces** xalan**"
		excludes="**/CVS* "
	/>
	<copyfile src="${build_lib}/database.properties" 
		filtering="yes" 
		dest="${installDir}/database.properties" 
	/>
	<copydir src="${web_docs}" 
  	dest="${installDir}"
		filtering="yes"
		includes="**.html"
		excludes="**/CVS* "
	/>
	
	<copydir src="${src_image_content}" 
  	dest="${build_image_content}"
		filtering="no"
		includes="**"
		excludes="**/CVS* "
	/>
	
	<copydir src="${src_xml}" 
  	dest="${installDir}"
		filtering="no"
		includes="**.dtd **.xsl"
		excludes="**/CVS* " 
	/>
</target>		
</project>
