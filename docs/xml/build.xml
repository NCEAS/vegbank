<?xml version="1.0" encoding="UTF-8"?>
<project name="vegbank_web" default="init" basedir=".">
  <!-- buildlimit.xml build the main VegBank xml to just a certain type of field, i.e. logical model fields or implementation fields
    If you dont want to limit the xml this way, then target=skip -->
  <target name="init">
    <echo>
  	Targets: {init} allfields logical implementation clean-local-html clean-dest-html **buildnewbuild **distdatadic **dd-index **dd-guide
  	  ** indicates targets that are referenced automatically by selected one of the first three targets
  </echo>
    <!-- freely editable variables -->
    <property name="origData" value="db_model_vegbank.xml"/>
    <property name="htmlPrefix" value="dd"/>
    <property name="newbuildname" value="buildto_dd_html.xml"/>
    <property name="limitData" value="db_model_vegbank_limited.xml"/>
    <!-- do not edit the following variables unless you have replaced with new xsl file -->
    <property name="limitstyle" value="db_model_limit.xsl"/>
    <property name="stylenewbuild" value="db_model_newbuild.xsl"/>
    <property name="styleTableView" value="dd-tableview.xsl"/>
    <property name="styleFieldView" value="dd-fieldview.xsl"/>
    <property name="style-index" value="dd-index.xsl"/>
    <property name="style-guide" value="dd-guide.xsl"/>
    <property name="guide-data" value="dd-guide.xml"/>
    <!-- db dic web server -->
    <property name="tomcat.home.dir" value="/usr/local/devtools/jakarta-tomcat"/>
    <property name="dictionary_server" value="${tomcat.home.dir}/webapps/vegbank/dbdictionary/"/>
    <property name="style_server" value="${tomcat.home.dir}/webapps/vegbank/includes/"/>
    <!-- filters -->
    <filter filtersfile="${style_server}/filters_detokened.properties"/>
    <filter token="stylesheet" value="/vegbank/includes/default.css"/>
  </target>
  <target name="logical" depends="init">
    <echo>Limiting fields to logical</echo>
    <style out="${limitData}" in="${origData}" extension=".xml" style="${limitstyle}" force="true">
      <param name="whichModel" expression="logical"/>
    </style>
    <antcall target="buildnewbuild"/>
  </target>
  <target name="implementation" depends="init">
    <echo>Limiting fields to implementation</echo>
    <style out="${limitData}" in="${origData}" extension=".xml" style="${limitstyle}" force="true">
      <param name="whichModel" expression="implementation"/>
    </style>
    <antcall target="buildnewbuild"/>
  </target>
  <target name="allfields" depends="init">
    <echo>No Limit on fields</echo>
    <copy file="${origData}" tofile="${limitData}" overwrite="true"/>
    <antcall target="buildnewbuild"/>
  </target>
  <!-- builds new build file to distribute html -->
  <target name="buildnewbuild" depends="init">
    <!-- create new build file to run ant on -->
    <echo>Writing new build file</echo>
    <style out="${newbuildname}" in="${limitData}" extension=".xml" style="${stylenewbuild}" force="true">
      <!-- file for html to be built from -->
      <param name="infile" expression="${limitData}"/>
      <!-- stylesheet for html to be made from  -->
      <param name="style" expression="${styleTableView}"/>
      <param name="styleField" expression="${styleFieldView}"/>
      <param name="htmlPrefix" expression="${htmlPrefix}"/>
    </style>
    <antcall target="dd-index"/>
  </target>
  <target name="dd-index" depends="init">
    <echo>Writing new data dictionary index page.</echo>
    <style out="${htmlPrefix}-index.html" in="${limitData}" extension=".html" style="${style-index}" force="true">
      <param name="htmlPrefix" expression="${htmlPrefix}"/>
    </style>
    <antcall target="dd-guide"/>
  </target>
  <target name="dd-guide" depends="init">
    <echo>Wiriting new datadictionary guide</echo>
    <style out="${htmlPrefix}-guide.html" in="${guide-data}" extension=".html" style="${style-guide}" force="true">
      <param name="htmlPrefix" expression="${htmlPrefix}"/>
    </style>
    <antcall target="distdatadic"/>
  </target>
  <!-- distributes html -->
  <target name="distdatadic" depends="init">
    <echo>Writing new html datadictionary files</echo>
    <ant antfile="${newbuildname}"/>
    <echo>Copying new files to server, filtering tokens</echo>
    <copy todir="${dictionary_server}" filtering="yes">
      <fileset dir=".">
        <include name="${htmlPrefix}*.html"/>
      </fileset>
    </copy>
  </target>
  <target name="clean-local-html" depends="init">
    <delete>
      <fileset dir="./">
        <include name="${htmlPrefix}*.html"/>
      </fileset>
    </delete>
  </target>
    <target name="clean-dest-html" depends="init">
    <delete>
      <fileset dir="${dictionary_server}">
        <include name="${htmlPrefix}*.html"/>
      </fileset>
    </delete>
  </target>
</project>
