<?xml version="1.0" encoding="UTF-8"?>
<project name="vegbank_xml" default="init" basedir=".">
  <!-- buildlimit.xml build the main VegBank xml to just a certain type of field, i.e. logical model fields or implementation fields
    If you dont want to limit the xml this way, then target=allfields-->
  <target name="init">
    <echo>
  	Targets: {init} allfields logical implementation clean-local-html clean-dest-html  dist-closedlist-tokenfile  dist-dataxml **dictionary2html **distdatadic **dd-index **dd-guide
  	  ** indicates targets that are referenced automatically by selected one of the first three targets
  </echo>
    <!-- freely editable variables -->
    <property name="origData" value="db_model_vegbank.xml"/>
    <property name="htmlPrefix" value="dd"/>
    <property name="limitData" value="db_model_vegbank_limited.xml"/>
    <!-- do not edit the following variables unless you have replaced with new xsl file -->
    <property name="limitstyle" value="db_model_limit.xsl"/>
    <property name="styleTableView" value="dd-tableview.xsl"/>
    <property name="styleFieldView" value="dd-fieldview.xsl"/>
    <property name="style-index" value="dd-index.xsl"/>
    <property name="style-guide" value="dd-guide.xsl"/>
    <property name="guide-data" value="dd-guide.xml"/>
    <!-- db dic web server -->
    <property name="tomcat.home.dir" value="/usr/local/devtools/jakarta-tomcat"/>
    <property name="dictionary_server" value="${tomcat.home.dir}/webapps/vegbank/dbdictionary/"/>
    <property name="style_server" value="${tomcat.home.dir}/webapps/vegbank/includes/"/>
    <property name="static_xmlserver" value="/var/www/html/xml"/>
    <!-- filters -->
    <filter filtersfile="${style_server}/filters_detokened.properties"/>
    <filter filtersfile="${style_server}/manual_filters.properties"/>
    <filter token="stylesheet" value="/vegbank/includes/default.css"/>
  </target>
  <target name="logical" depends="init">
    <echo>Limiting fields to logical</echo>
    <style out="${limitData}" in="${origData}" extension=".xml" style="${limitstyle}" force="true">
      <param name="whichModel" expression="logical"/>
    </style>
    <antcall target="dictionary2html"/>
  </target>
  <target name="implementation" depends="init">
    <echo>Limiting fields to implementation</echo>
    <style out="${limitData}" in="${origData}" extension=".xml" style="${limitstyle}" force="true">
      <param name="whichModel" expression="implementation"/>
    </style>
    <antcall target="dictionary2html"/>
  </target>
  <target name="allfields" depends="init">
    <echo>No Limit on fields</echo>
    <copy file="${origData}" tofile="${limitData}" overwrite="true"/>
    <antcall target="dictionary2html"/>
  </target>
  <target name="dictionary2html" depends="init">
    <!-- create new build file to run ant on -->
    <echo>Writing field views</echo>
    <style out="BOGUSFld.txt" in="${limitData}" extension=".xml" style="${styleFieldView}" force="true">
      <!-- file for html to be built from -->
      <param name="htmlPrefix" expression="${htmlPrefix}"/>
    </style>
    <echo>Writing table views</echo>
    <style out="BOGUSTbl.txt" in="${limitData}" extension=".xml" style="${styleTableView}" force="true">
      <!-- file for html to be built from -->
      <param name="htmlPrefix" expression="${htmlPrefix}"/>
    </style>
    <antcall target="dd-index"/>
  </target>
  <target name="dd-index" depends="init">
    <echo>Writing new data dictionary index page.</echo>
    <style out="${htmlPrefix}-index.html" in="${limitData}" extension=".html" style="${style-index}" force="true">
      <param name="htmlPrefix" expression="${htmlPrefix}"/>
    </style>
    <antcall target="dd-guide"/>
  </target>
  <target name="dd-guide" depends="init">
    <echo>Wiriting new datadictionary guide</echo>
    <style out="${htmlPrefix}-guide.html" in="${guide-data}" extension=".html" style="${style-guide}" force="true">
      <param name="htmlPrefix" expression="${htmlPrefix}"/>
    </style>
    <antcall target="distdatadic"/>
  </target>
  <!-- distributes html -->
  <target name="distdatadic" depends="init">
    <echo>Copying new files to server, filtering tokens</echo>
    <copy todir="${dictionary_server}" filtering="yes">
      <fileset dir=".">
        <include name="${htmlPrefix}*.html"/>
      </fileset>
    </copy>
  </target>
  <target name="clean-local-html" depends="init">
    <delete>
      <fileset dir="./">
        <include name="${htmlPrefix}*.html"/>
      </fileset>
    </delete>
  </target>
  <target name="clean-dest-html" depends="init">
    <delete>
      <fileset dir="${dictionary_server}">
        <include name="${htmlPrefix}*.html"/>
      </fileset>
    </delete>
  </target>
  <target name="dist-closedlist-tokenfile" depends="init">
    <style out="${style_server}/closedlist-tokens.properties" in="${origData}" extension=".properties" style="closedList_forms_options.xsl" force="true"/>
  </target>
  <target name="dist-dataxml" depends="init">
    <mkdir dir="${static_xmlserver}"/>
    <copy todir="${static_xmlserver}" flatten="true" filtering="no">
      <fileset dir="./dataxml">
        <include name="*.xsd"/>
        <include name="*.xml"/>
        <include name="*.xsl"/>
      </fileset>
    </copy>
    <copy todir="${static_xmlserver}" flatten="true" filtering="yes">
      <fileset dir="./dataxml">
        <include name="*.html"/>
      </fileset>
    </copy>
  </target>
</project>
